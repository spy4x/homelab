# Ansible Inventory for Homelab
# This file defines all hosts (servers) that Ansible will manage
# Each host can have variables that customize how playbooks run
# Sensitive data (IP, port, tokens) is loaded from .env.ansible

# To use SSH config alias instead of IP/port:
# 1. Comment out ansible_host and ansible_port below
# 2. Set ansible_host to your SSH config alias (e.g., 'spy4x-server-mini-pc-external')
# 3. Ansible will use your ~/.ssh/config settings automatically

all:
  children:
    homelab_servers:
      hosts:
        homelab:
          # Primary server (Fedora mini PC)
          ansible_host: "{{ lookup('env', 'ANSIBLE_HOST') }}"
          ansible_port: "{{ lookup('env', 'ANSIBLE_PORT') }}"
          ansible_user: spy4x
          ansible_ssh_private_key_file: ~/.ssh/id_ed25519

          # Paths specific to this server
          deno_install_path: /home/spy4x/.deno
          apps_path: /home/spy4x/ssd-2tb/apps
          backup_log_path: /home/spy4x/backup.log
          env_file_path: /home/spy4x/ssd-2tb/apps/.env

          # Backup configuration
          backup_cron_hour: 2
          backup_cron_minute: 30

          # Notification settings (loaded from .env.ansible)
          ntfy_url_hardware: "{{ lookup('env', 'NTFY_URL_HARDWARE') }}"
          ntfy_token_hardware: "{{ lookup('env', 'NTFY_TOKEN_HARDWARE') }}"
          ntfy_url_security: "{{ lookup('env', 'NTFY_URL_SECURITY') }}"
          ntfy_token_security: "{{ lookup('env', 'NTFY_TOKEN_SECURITY') }}"

          # SMART monitoring temperature thresholds (loaded from .env.ansible)
          smart_temp_change: "{{ lookup('env', 'SMART_TEMP_CHANGE_THRESHOLD') | default('4', true) }}"
          smart_temp_info: "{{ lookup('env', 'SMART_TEMP_INFO_THRESHOLD') | default('35', true) }}"
          smart_temp_critical: "{{ lookup('env', 'SMART_TEMP_CRITICAL_THRESHOLD') | default('40', true) }}"

          # Fail2ban monitored containers (primary server has more services)
          fail2ban_docker_jails:
            - name: vaultwarden
              container: vaultwarden
              maxretry: 5
              bantime: 12h
              findtime: 5m
            - name: traefik-auth
              container: proxy
              maxretry: 5
              bantime: 1h
              findtime: 10m
            - name: home-assistant
              container: home-assistant
              maxretry: 5
              bantime: 1h
              findtime: 10m

        homelab_secondary:
          # Secondary server (Debian Raspberry Pi)
          ansible_host: spy4x-pi-external
          ansible_port: 45737
          ansible_user: spy4x
          ansible_ssh_private_key_file: ~/.ssh/id_ed25519

          # Paths specific to this server
          deno_install_path: /home/spy4x/.deno
          apps_path: /home/spy4x/secondary
          backup_log_path: /home/spy4x/backup.log
          env_file_path: /home/spy4x/secondary/.env

          # Backup configuration
          backup_cron_hour: 3
          backup_cron_minute: 30

          # Notification settings (reuse same tokens)
          ntfy_url_hardware: "{{ lookup('env', 'NTFY_URL_HARDWARE') }}"
          ntfy_token_hardware: "{{ lookup('env', 'NTFY_TOKEN_HARDWARE') }}"
          ntfy_url_security: "{{ lookup('env', 'NTFY_URL_SECURITY') }}"
          ntfy_token_security: "{{ lookup('env', 'NTFY_TOKEN_SECURITY') }}"

          # SMART monitoring (Raspberry Pi may not have SMART support for SD card)
          # Use default temps, adjust if needed
          smart_temp_change: "{{ lookup('env', 'SMART_TEMP_CHANGE_THRESHOLD') | default('4', true) }}"
          smart_temp_info: "{{ lookup('env', 'SMART_TEMP_INFO_THRESHOLD') | default('45', true) }}"
          smart_temp_critical: "{{ lookup('env', 'SMART_TEMP_CRITICAL_THRESHOLD') | default('55', true) }}"

          # Fail2ban monitored containers (secondary has fewer services)
          fail2ban_docker_jails:
            - name: traefik-auth
              container: traefik
              maxretry: 5
              bantime: 1h
              findtime: 10m

      vars:
        # These variables apply to all servers in the homelab_servers group
        ansible_python_interpreter: /usr/bin/python3

        # User to run services as
        homelab_user: spy4x
